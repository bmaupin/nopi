#### Resources

- [https://www.3dbrew.org/wiki/CIA](https://www.3dbrew.org/wiki/CIA)

#### CIA header

| Start | Size   | Description                              |
| ----- | ------ | ---------------------------------------- |
| 0x00  | 0x04   | Archive Header Size<br>Usually `0x2020`  |
| 0x04  | 0x02   | Type<br>Usually `0x0`                    |
| 0x06  | 0x02   | Version<br>Usually `0x0`                 |
| 0x08  | 0x04   | Certificate chain size                   |
| 0x0C  | 0x04   | Ticket size                              |
| 0x10  | 0x04   | TMD file size                            |
| 0x14  | 0x04   | Meta size (0 if no Meta data is present) |
| 0x18  | 0x08   | Content size                             |
| 0x20  | 0x2000 | Content Index                            |

#### Changing a CIA file

| When this is changed     | This needs to be updated                                                                                                                                                                                                                                                                                          | Notes                                                                               |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| (ticket) ticket ID       | ticket signature                                                                                                                                                                                                                                                                                                  | `0x0004` followed by 6 random bytes                                                 |
| (ticket) title ID        | (ticket) ticket ID<br>(ticket) title key<br>(TMD) title ID<br>(NCCH) title ID<br>(NCCH) program ID<br>ticket signature                                                                                                                                                                                            | `0x00040000`, 3 random bytes, then `0x00`<br>Each CIA should have a unique title ID |
| (ticket) title key       | ticket signature                                                                                                                                                                                                                                                                                                  | It looks like this can be completely random                                         |
| (TMD) title ID           | TMD signature                                                                                                                                                                                                                                                                                                     |                                                                                     |
| (TMD) info record hash   | ???, TMD signature                                                                                                                                                                                                                                                                                                | TODO: I'm not even sure what this is ðŸ˜†                                             |
| (TMD) content chunk hash | ???, TMD signature                                                                                                                                                                                                                                                                                                | TODO                                                                                |
| (TMD) content size       | TMD signature                                                                                                                                                                                                                                                                                                     |                                                                                     |
| (TMD) content hash       | TMD signature                                                                                                                                                                                                                                                                                                     |                                                                                     |
| (NCCH) content size      | (header) content size, (TMD) content size, NCCH signature                                                                                                                                                                                                                                                         |                                                                                     |
| (NCCH) title ID          | NCCH signature                                                                                                                                                                                                                                                                                                    |                                                                                     |
| (NCCH) program ID        | NCCH signature                                                                                                                                                                                                                                                                                                    |                                                                                     |
| (NCCH) product code      | NCCH signature                                                                                                                                                                                                                                                                                                    | Does this need to be changed?                                                       |
| (NCCH) RomFS offset      | NCCH signature                                                                                                                                                                                                                                                                                                    |                                                                                     |
| (NCCH) RomFS size        | NCCH signature                                                                                                                                                                                                                                                                                                    |                                                                                     |
| (NCCH) RomFS hash        | NCCH signature                                                                                                                                                                                                                                                                                                    |                                                                                     |
| (RomFS) file content     | (file metadata) file data offset (for every file following the file modified)<br>(file metadata) file data size<br>(RomFS) level 3 size<br>(RomFS) level 2 hashes<br>(NCCH) content size<br>(NCCH) RomFS size<br>(NCCH) RomFS hash<br>(TMD) content hash?<br>(TMD) content chunk hash?<br>(TMD) info record hash? |                                                                                     |
| (RomFS) level 2 hashes   | (RomFS) level 1 hashes<br>(RomFS) level 2 size<br>(NCCH) RomFS size<br>(NCCH) RomFS hash                                                                                                                                                                                                                          |                                                                                     |
| (RomFS) level 1 hashes   | (RomFS) master hash<br>~~(RomFS) level 1 size~~<br>(NCCH) RomFS size<br>(NCCH) RomFS hash                                                                                                                                                                                                                         |                                                                                     |
| (RomFS) master hash      | ~~(RomFS) master hash size~~<br>(NCCH) RomFS size<br>(NCCH) RomFS hash                                                                                                                                                                                                                                            |                                                                                     |
